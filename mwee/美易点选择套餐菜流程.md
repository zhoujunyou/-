
####美易点选择套餐菜流程

1.点击菜品

```json
{
  "bonus": true,
  "cashierMenu": false,
  "categoryCode": "93",
  "config": 139736,
  "config2": 12,
  "currentUnit": {
    "fdBargainPrice": 0,
    "fdBuyGiftPrice": 0,
    "fdInvQty": 0,
    "fdOriginPrice": 19,
    "fdSalePrice": 19,
    "fdVIPPrice": 20,
    "fiInitCount": 0,
    "fiItemCd": "1903040001",
    "fiOrderUintCd": "1903040002",
    "fiStatus": 1,
    "fsOrderUint": "套",
    "fsShopGUID": "217176"
  },
  "fdLunchBoxCost": 0,
  "fiLedgerMode": 0,
  "fiUpMenuOrder": 1,
  "fsBarCode": "",
  "fsBillSourceNo": "",
  "fsHelpCode": "tly",
  "fsItemId": "102",
  "gift": false,
  "isCategory": false,
  "itemID": "1903040001",
  "menuBiz": {
    "bizConfig": 0,
    "bonusAuthorizerId": "",
    "bonusUserId": "",
    "buyNum": 0,
    "createTime": "",
    "currentPriceTimes": 0,
    "delimitNum": 0,
    "discountAmount": 0,
    "discountReason": "",
    "discountUserID": "",
    "discountUserName": "",
    "extInfo": "",
    "fiHurryTimes": 0,
    "fiItemMakeState": 0,
    "fiMenuProgress": 0,
    "fsGeneralNote": "",
    "fsSpecialNote": "",
    "giftNum": 0,
    "giftReason": "",
    "giftTime": "",
    "giftUserID": "",
    "giftUserName": "",
    "isDefault": false,
    "isTakeAway": false,
    "memPriceWithouMem": false,
    "menuSellTime": "",
    "menuSellType": 1,
    "nomalTotalPrice": 0,
    "note": "",
    "orderSeqID": 0,
    "packageSplitDiscount": 0,
    "packageSplitOrigin": 0,
    "packageSplitPrice": 0,
    "pokeNo": 0,
    "priceExtraTotal": 0,
    "priceService": 0,
    "priceTotalOriginAfterGift": 0,
    "selectMulProcedure": [],
    "selectNote": [],
    "selectOrderNote": [],
    "selectedExtraStr": "",
    "selectedModifier": [],
    "selectedPackageItems": [],
    "takeAway": false,
    "thirduniq": "",
    "totalPrice": 0,
    "uniq": "",
    "voidNum": 0,
    "voidReson": "",
    "voidTime": "",
    "voidUserID": "",
    "voidUserName": "",
    "wait": false
  },
  "menuTemporary": false,
  "mergedItemInfo": "",
  "name": "唐老鸭",
  "originTableId": "",
  "originTableName": "",
  "outOfStock": false,
  "outOfStockStatus": 0,
  "packID": "0",
  "packSubID": "0",
  "price": 19.00,
  "rootMenuClsId": "93",
  "rootMenuClsName": "套餐",
  "rootMenuClsSortOrder": 99,
  "terminal_Name": "",
  "terminal_id": "",
  "thirdMenuId": "",
  "thirdMenuName": "",
  "thirdUnitId": "",
  "thirdUnitName": "",
  "useMemberPrice": false
}
```

2. 判断是否是套餐 (config & 256) == 256 展示MenuPackageEditorDialogFragment 传入MenuItem,isMember,isOrdered及iResponse回调对象

3. MenuPackageEditorDialogFragment中在AppCache.getInstance().menuPackages通过menuItem.itemID获取MenuPackageGroup集合 menuPackages refresh时从DB载入
  ```json
  {
  "id": "1903040003",
  "isRequired": false,
  "isSolid": false,
  "itemList": [
    {
      "bonus": false,
      "cashierMenu": false,
      "categoryCode": "1903040003",
      "config": 0,
      "config2": 0,
      "currentUnit": {
        "fdBargainPrice": 0,
        "fdBuyGiftPrice": 0,
        "fdInvQty": 0,
        "fdOriginPrice": 9,
        "fdSalePrice": 0,
        "fdVIPPrice": 0,
        "fiInitCount": 1,
        "fiItemCd": "1810100040",
        "fiOrderUintCd": "1810100043",
        "fiStatus": 1,
        "fsOrderUint": "份",
        "fsShopGUID": "217176"
      },
      "fdLunchBoxCost": 0,
      "fiLedgerMode": 0,
      "fiUpMenuOrder": 0,
      "fsBarCode": "",
      "fsBillSourceNo": "",
      "fsHelpCode": "",
      "fsItemId": "",
      "gift": false,
      "isCategory": false,
      "itemID": "1810100040",
      "menuBiz": {
        "bizConfig": 0,
        "bonusAuthorizerId": "",
        "bonusUserId": "",
        "buyNum": 1,
        "createTime": "",
        "currentPriceTimes": 0,
        "delimitNum": 0,
        "discountAmount": 0,
        "discountReason": "",
        "discountUserID": "",
        "discountUserName": "",
        "extInfo": "",
        "fiHurryTimes": 0,
        "fiItemMakeState": 0,
        "fiMenuProgress": 0,
        "fsGeneralNote": "",
        "fsSpecialNote": "",
        "giftNum": 0,
        "giftReason": "",
        "giftTime": "",
        "giftUserID": "",
        "giftUserName": "",
        "isDefault": false,
        "isTakeAway": false,
        "memPriceWithouMem": false,
        "menuSellTime": "",
        "menuSellType": 1,
        "nomalTotalPrice": 0,
        "note": "",
        "orderSeqID": 0,
        "packageSplitDiscount": 0,
        "packageSplitOrigin": 0,
        "packageSplitPrice": 0,
        "pokeNo": 0,
        "priceExtraTotal": 0,
        "priceService": 0,
        "priceTotalOriginAfterGift": 0,
        "selectMulProcedure": [],
        "selectNote": [],
        "selectOrderNote": [],
        "selectedExtraStr": "",
        "selectedModifier": [],
        "selectedPackageItems": [],
        "takeAway": false,
        "thirduniq": "",
        "totalPrice": 0,
        "uniq": "",
        "voidNum": 0,
        "voidReson": "",
        "voidTime": "",
        "voidUserID": "",
        "voidUserName": "",
        "wait": false
      },
      "menuTemporary": false,
      "mergedItemInfo": "",
      "name": "火腿玉米粥",
      "originTableId": "",
      "originTableName": "",
      "outOfStock": false,
      "outOfStockStatus": 0,
      "packID": "1903040001",
      "packSubID": "1903040003",
      "price": 0,
      "rootMenuClsId": "102",
      "rootMenuClsName": "粥类",
      "rootMenuClsSortOrder": 0,
      "terminal_Name": "",
      "terminal_id": "",
      "thirdMenuId": "",
      "thirdMenuName": "",
      "thirdUnitId": "",
      "thirdUnitName": "",
      "useMemberPrice": false
    }
  ],
  "name": "A",
  "pacFoodNum": 1,
  "pacName2": "",
  "splitePercent": 0
  }
  ```

4. 展示MenuPackageItemChoiceFragment 传入menuPackageGroups，selectCache，isOrdered，isMember及OnMenuPackageItemChoiceListener回调 展示menuPackageGroups列表，menuPackageGroup.isSolid表示固定配菜默认itemList中项默认选择。将itemList内菜品对唯一标示作为键放入selectCache中(MenuPackageGroup为套餐头，itemList中是套餐头下的菜品)

5. 点击子菜品item,通过Menuitem.currentUnit.fiOrderUintCd是否在AppCache.getInstance().sellOutUnits中判断是否已经估清**(对应美小二套餐沽清需求)**。selectCache用于判断是否选中.通过menuPackageGroup.pacFoodNum表示套餐最大可选菜品数量。添加后调用OnMenuPackageItemChoiceListener.onMenuPackageItemDataChanged(selectPackageItems, voidReason, voidUser)

6. MenuPackageEditorDialogFragment的selectedPackageItems加入所选的MenuItem 点击MenuPackageEditorDialogFragment左边菜品做法 operationCache设为当前item 显示MenuPackageItemMethodChoiceFragment 传入item.itemId,menuBiz.selectMulProcedure(已选做法) 及在tbask表中获取这个菜品的做法List<AskDBModel> 和OnMenuPackageItemMethodChoiceListener。

7.  MenuPackageItemMethodChoiceFragment点击做法 将已选的做法列表OnMenuPackageItemMethodChoiceListener回传到MenuPackageEditorDialogFragment更新operationCache.menuBiz的selectMulProcedure

8. MenuPackageEditorDialogFragment点击确定 通过DinnerMenuUtil.checkMultiPracticeInPackage(item)
   判断做法数量是否合适。MenuItem.fipracticemin最小做法,MenuItem.fipracticemax最大做法.第二次确定

   将当前套餐menuItem  menuItem.menuBiz.selectedPackageItems.addAll(selectedPackageItems);回传到OrderDishesBizUtil.计算特价后调用DinnerFoodOrderFragment的clickone(MenuItem item) addMenu(MenuItem item)添加到mDishCache中(这里有个合菜逻辑和一个添加到临时菜列表orderDishesCache.tempSelectedMenuList)

9. 下单调用table/openAndCheckToOrder接口传入TempOrderDishesCache

   ```json
   {
     "orderDishesCache": {
       "bookCustName": "",
       "businessDate": "2018-10-10",
       "cardNo": "",
       "commitID": "",
       "currentHostID": "主机站点",
       "currentSectionID": "1",
       "diningStandard": false,
       "diningStandardAmt": -1,
       "eatTime": "",
       "eatType": 0,
       "fsmareaid": "1",
       "fsmtableid": "1",
       "fsmtablename": "A1",
       "isMember": false,
       "isRapidTempOrderCache": false,
       "minStandardAmt": -1,
       "note": "",
       "orderRemark": "",
       "personNum": 1,
       "phone": "",
       "source": 0,
       "tempCreateTime": "",
       "tempPriceTotalOriginAfterGift": 19.00,
       "tempSelectedMenuList": [
         {
           "bonus": true,
           "cashierMenu": false,
           "categoryCode": "93",
           "config": 139736,
           "config2": 12,
           "currentUnit": {
             "fdBargainPrice": 0,
             "fdBuyGiftPrice": 0,
             "fdInvQty": 0,
             "fdOriginPrice": 19,
             "fdSalePrice": 19,
             "fdVIPPrice": 20,
             "fiInitCount": 0,
             "fiItemCd": "1903040001",
             "fiOrderUintCd": "1903040002",
             "fiStatus": 1,
             "fsOrderUint": "套",
             "fsShopGUID": "217176"
           },
           "fdLunchBoxCost": 0,
           "fiLedgerMode": 0,
           "fiUpMenuOrder": 1,
           "fsBarCode": "",
           "fsBillSourceNo": "",
           "fsHelpCode": "tly",
           "fsItemId": "102",
           "gift": false,
           "isCategory": false,
           "itemID": "1903040001",
           "menuBiz": {
             "bizConfig": 0,
             "bonusAuthorizerId": "",
             "bonusUserId": "",
             "buyNum": 1,
             "createTime": "2019-03-04 18:39:58",
             "currentPriceTimes": 0,
             "delimitNum": 0,
             "discountAmount": 0,
             "discountReason": "",
             "discountUserID": "",
             "discountUserName": "",
             "extInfo": "",
             "fiHurryTimes": 0,
             "fiItemMakeState": 0,
             "fiMenuProgress": 0,
             "fsGeneralNote": "",
             "fsSpecialNote": "",
             "giftNum": 0,
             "giftReason": "",
             "giftTime": "",
             "giftUserID": "",
             "giftUserName": "",
             "isDefault": false,
             "isTakeAway": false,
             "memPriceWithouMem": false,
             "menuSellTime": "",
             "menuSellType": 1,
             "nomalTotalPrice": 19.00,
             "note": "",
             "orderSeqID": 0,
             "packageSplitDiscount": 0,
             "packageSplitOrigin": 0,
             "packageSplitPrice": 0,
             "pokeNo": 0,
             "priceExtraTotal": 0,
             "priceService": 0,
             "priceTotalOriginAfterGift": 19.00,
             "selectMulProcedure": [],
             "selectNote": [],
             "selectOrderNote": [],
             "selectedExtraStr": "",
             "selectedModifier": [],
             "selectedPackageItems": [
               {
                 "bonus": false,
                 "cashierMenu": false,
                 "categoryCode": "1903040003",
                 "config": 106652,
                 "config2": 4,
                 "currentUnit": {
                   "fdBargainPrice": 0,
                   "fdBuyGiftPrice": 0,
                   "fdInvQty": 0,
                   "fdOriginPrice": 9,
                   "fdSalePrice": 0,
                   "fdVIPPrice": 0,
                   "fiInitCount": 1,
                   "fiItemCd": "1810100040",
                   "fiOrderUintCd": "1810100043",
                   "fiStatus": 1,
                   "fsOrderUint": "份",
                   "fsShopGUID": "217176"
                 },
                 "fdLunchBoxCost": 0,
                 "fiLedgerMode": 0,
                 "fiUpMenuOrder": 0,
                 "fsBarCode": "",
                 "fsBillSourceNo": "",
                 "fsHelpCode": "",
                 "fsItemId": "",
                 "gift": false,
                 "isCategory": false,
                 "itemID": "1810100040",
                 "menuBiz": {
                   "bizConfig": 0,
                   "bonusAuthorizerId": "",
                   "bonusUserId": "",
                   "buyNum": 1,
                   "createTime": "2019-03-04 18:06:24",
                   "currentPriceTimes": 0,
                   "delimitNum": 0,
                   "discountAmount": 0,
                   "discountReason": "",
                   "discountUserID": "",
                   "discountUserName": "",
                   "extInfo": "",
                   "fiHurryTimes": 0,
                   "fiItemMakeState": 0,
                   "fiMenuProgress": 0,
                   "fsGeneralNote": "",
                   "fsSpecialNote": "",
                   "giftNum": 0,
                   "giftReason": "",
                   "giftTime": "",
                   "giftUserID": "",
                   "giftUserName": "",
                   "isDefault": false,
                   "isTakeAway": false,
                   "memPriceWithouMem": false,
                   "menuSellTime": "",
                   "menuSellType": 1,
                   "nomalTotalPrice": 9.00,
                   "note": "",
                   "orderSeqID": 0,
                   "packageSplitDiscount": 0,
                   "packageSplitOrigin": 0,
                   "packageSplitPrice": 0,
                   "pokeNo": 0,
                   "priceExtraTotal": 0,
                   "priceService": 0,
                   "priceTotalOriginAfterGift": 0.00,
                   "selectMulProcedure": [
                     {
                       "fdAddPrice": 0,
                       "fiDataSource": 0,
                       "fiId": "100299646",
                       "fiStatus": 1,
                       "fsAskGpId": "-1",
                       "fsAskName": "送",
                       "fsShopGUID": "217176",
                       "fsUpdateTime": "2019-03-04 17:02:03",
                       "fsUpdateUserId": "255402",
                       "fsUpdateUserName": "MWposcs",
                       "sync": 0
                     },
                     {
                       "fdAddPrice": 0,
                       "fiDataSource": 0,
                       "fiId": "100299647",
                       "fiStatus": 1,
                       "fsAskGpId": "-1",
                       "fsAskName": "方",
                       "fsShopGUID": "217176",
                       "fsUpdateTime": "2019-03-04 17:02:03",
                       "fsUpdateUserId": "255402",
                       "fsUpdateUserName": "MWposcs",
                       "sync": 0
                     }
                   ],
                   "selectNote": [],
                   "selectOrderNote": [],
                   "selectedExtraStr": "送;方",
                   "selectedModifier": [],
                   "selectedPackageItems": [],
                   "takeAway": false,
                   "thirduniq": "",
                   "totalPrice": 0.00,
                   "uniq": "3e832d97-6a4e-4e38-a69d-0fddaf01e9421903041839582",
                   "voidNum": 0,
                   "voidReson": "",
                   "voidTime": "",
                   "voidUserID": "",
                   "voidUserName": "",
                   "wait": false
                 },
                 "menuTemporary": false,
                 "mergedItemInfo": "",
                 "name": "火腿玉米粥",
                 "originTableId": "1",
                 "originTableName": "A1",
                 "outOfStock": false,
                 "outOfStockStatus": 0,
                 "packID": "1903040001",
                 "packSubID": "1903040003",
                 "price": 0.00,
                 "rootMenuClsId": "102",
                 "rootMenuClsName": "粥类",
                 "rootMenuClsSortOrder": 0,
                 "terminal_Name": "",
                 "terminal_id": "",
                 "thirdMenuId": "",
                 "thirdMenuName": "",
                 "thirdUnitId": "",
                 "thirdUnitName": "",
                 "useMemberPrice": false
               }
             ],
             "takeAway": false,
             "thirduniq": "",
             "totalPrice": 19.00,
             "uniq": "bae68e8d-f39d-45ff-b104-a9a1ae1310eb1903041839583",
             "voidNum": 0,
             "voidReson": "",
             "voidTime": "",
             "voidUserID": "",
             "voidUserName": "",
             "wait": false
           },
           "menuTemporary": false,
           "mergedItemInfo": "",
           "name": "唐老鸭",
           "originTableId": "1",
           "originTableName": "A1",
           "outOfStock": false,
           "outOfStockStatus": 0,
           "packID": "0",
           "packSubID": "0",
           "price": 19.00,
           "rootMenuClsId": "93",
           "rootMenuClsName": "套餐",
           "rootMenuClsSortOrder": 99,
           "terminal_Name": "",
           "terminal_id": "4",
           "thirdMenuId": "",
           "thirdMenuName": "",
           "thirdUnitId": "",
           "thirdUnitName": "",
           "useMemberPrice": false
         }
       ],
       "tempTotalCount": 1,
       "tempTotalDiscountAmount": 0,
       "tempTotalMenuPrice": 19,
       "tempTotalMenuPriceWithinStandard": 0,
       "tempTotalMenuPriceWithoutStandard": 0,
       "tempTotalPrice": 19,
       "tempTotalService": 0,
       "thirdBizType": 0,
       "thirdOrderID": "",
       "waiterID": "admin",
       "waiterName": "管理员"
     },
     "hostID": "主机站点",
     "shopId": "217176",
     "fsUserId": "admin"
   }
   ```

   




